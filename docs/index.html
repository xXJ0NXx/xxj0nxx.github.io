<!doctype html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>3D Pinball for Windows - Space Cadet</title>
  <style>
    body {
      font-family: Tahoma, Geneva, Verdana, sans-serif;
      background-color: #3a6ea5;
      margin: 0;
      overflow: hidden;
    }
    canvas.emscripten {
      border: none;
      background-color: #000;
      width: 100vw;
      height: 100vh;
      display: block;
    }
    #status, #progress {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 20px;
    }
  </style>
</head>
<body>
  <div id="status">Downloading...</div>
  <progress hidden id="progress" max="100" value="0"></progress>
  <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" tabindex="-1"></canvas>

  <script>
    var statusElement = document.getElementById("status"),
        progressElement = document.getElementById("progress"),
        Module = {
          preRun: [],
          postRun: [],
          print: function(text) { console.log(text); },
          printErr: function(text) { console.error(text); },
          canvas: (function() {
            var e = document.getElementById("canvas");
            e.addEventListener("webglcontextlost", function(ev) {
              alert("WebGL context lost. You will need to reload the page.");
              ev.preventDefault();
            }, false);
            return e;
          })(),
          setStatus: function(text) {
            if (!Module.setStatus.last) Module.setStatus.last = {time: Date.now(), text: ""};
            if (text !== Module.setStatus.last.text) {
              var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/),
                  now = Date.now();
              if (!(m && now - Module.setStatus.last.time < 30)) {
                Module.setStatus.last.time = now;
                Module.setStatus.last.text = text;
                if (m) {
                  text = m[1];
                  progressElement.value = 100 * parseInt(m[2]);
                  progressElement.max = 100 * parseInt(m[4]);
                  progressElement.hidden = false;
                } else {
                  progressElement.value = null;
                  progressElement.max = null;
                  progressElement.hidden = true;
                  document.getElementById("canvas").style.display = "";
                }
                statusElement.innerHTML = text;
                if (text === "" || text === "All downloads complete.") {
                  statusElement.style.display = "none";
                  progressElement.style.display = "none";
                }
              }
            }
          },
          locateFile: function(path) {
            if (path.endsWith(".wasm")) return "SpaceCadetPinball.wasm";
            if (path.endsWith(".data")) return "SpaceCadetPinball.data";
            return path;
          }
        };
    Module.setStatus("Downloading...");
    window.onerror = function() {
      Module.setStatus("Exception thrown, see JavaScript console");
      Module.setStatus = function(text) {
        text && Module.printErr("[post-exception status] " + text);
      };
    };
  </script>

  <script async src="SpaceCadetPinball.js"></script>
</body>
</html>
